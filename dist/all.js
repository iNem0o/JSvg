"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),JNode=function(){function t(e){_classCallCheck(this,t),this.$node=$(document.createElementNS("http://www.w3.org/2000/svg",e)),this.position=function(t,e){return this.$node.attr({x:t,y:e}),this}}return _createClass(t,[{key:"attr",value:function(t,e){return this.$node.attr(t,e)}}]),t}(),_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),JSVG=function(){function t(e){_classCallCheck(this,t),this._named_sprites=[],e?(this.$svg=e,this.discoverStructure()):this.$svg=new JNode("svg").$node,this.root=new JSprite(this.$svg,(!0)),this.root.setStage(this),this.need_refresh=!1,this.setFramerate(),this.setTickrate(100)}return _createClass(t,[{key:"trigger",value:function(t,e){this.root.$node.trigger(t,e)}},{key:"on",value:function(t,e){this.root.$node.on(t,e)}},{key:"setTickrate",value:function(t){var e=this;clearInterval(this.tick_interval);var i=1e3/t,n=performance.now(),o=function t(){var t=performance.now(),o=[{time_ratio:(t-n)/i}];e.trigger("tick",o),n=t};return this.tick_interval=setInterval(o,i),this}},{key:"setFramerate",value:function(t){this.fps=t||"max";var e=this,i=function t(){e.need_refresh&&(e.root.refresh(),e.need_refresh=!1),"max"==e.fps&&window.requestAnimationFrame&&window.requestAnimationFrame(t)};return clearInterval(this.fps_interval),"max"==this.fps&&window.requestAnimationFrame?window.requestAnimationFrame(i):this.fps_interval=setInterval(i,1e3/this.fps),this}},{key:"askRefresh",value:function(){this.need_refresh=!0}},{key:"getRoot",value:function(){return this.$svg}},{key:"setViewBox",value:function(t,e,i,n){return this.$svg.attr("viewBox",t+" "+e+" "+i+" "+n),this}},{key:"addChild",value:function(t){return this.root.addChild(t),this}},{key:"discoverStructure",value:function(){var t=this;this.$svg.find("[data-sprite-name]").each(function(){t.discoverSprite($(this))})}},{key:"discoverSprite",value:function(t){var e=t.data("sprite-name"),i=new JSprite(t);this._named_sprites[e]=i;var n=t.attr("x");n&&(i.x=n,t.removeAttr("x"));var o=t.attr("y");o&&(i.y=o,t.removeAttr("y"));var s=t.data("pivot-x"),r=t.data("pivot-y");i.setPivot(s,r)}},{key:"getSpriteByName",value:function(t){return this._named_sprites[t]}}]),t}(),JKeyboard=function(){function t(){_classCallCheck(this,t),this.left=37,this.right=39,this.up=38,this.down=40,this.esc=27,this.enter=13,this.space=32,this.keys=[];var e=this;$(document).on("keydown",function(t){e.keys[t.which]=!0,116!=t.which&&(t.preventDefault(),t.stopPropagation())}).on("keyup",function(t){e.keys[t.which]=!1})}return _createClass(t,[{key:"isDown",value:function(t){return!!this.keys[t]}}]),t}(),JRect=function(t){function e(t,i,n,o){_classCallCheck(this,e);var s=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"rect"));return s.position(t,i).attr({width:n,height:o}),s}return _inherits(e,t),e}(JNode),_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),JSprite=function(){function t(e,i){_classCallCheck(this,t),e instanceof JNode&&(e=e.$node),i?(this.$node=e,this.$node_origin=e.find(">.child-node")):(e.wrap(document.createElementNS("http://www.w3.org/2000/svg","g")),this.$node=e.parent(),this.$node_origin=e,this.$node_origin.addClass("child-node")),this.root=null,this._children=[],this._position={x:0,y:0,z:0},this._rotation={x:0,y:0,z:0},this._pivotMove={x:0,y:0,z:0},this._scale={x:1,y:1,z:1},this.shortRotation=!0,this.rotationForceDirection=0,this._tween_rotation=!1,this._tween_position=!1,this.needRefresh=!1}return _createClass(t,[{key:"clone",value:function(){return new t(this.$node.clone(),(!0))}},{key:"addChild",value:function(t){return this._children.push(t),t.setStage(this.root),this.addGraphic(t),this}},{key:"addGraphic",value:function(t){this.$node.append(t.$node)}},{key:"askRefresh",value:function(){this.needRefresh=!0,this.root?this.root.askRefresh():this.applyTransform()}},{key:"refresh",value:function(){this.applyTransform(),this._children.every(function(t){t.refresh()})}},{key:"applyTransform",value:function(){if(this.needRefresh){var t=function(t){return Math.round(100*t)/100};this.needRefresh=!1;var e="scale("+t(this._scale.x)+")",i="rotate("+t(this._rotation.z)+" "+t(this._pivotMove.x)+","+t(this._pivotMove.y)+")",n=t(this._position.x-this._pivotMove.x*this._scale.x),o=t(this._position.y-this._pivotMove.y*this._scale.y),s="translate("+n+" "+o+")";this.$node.attr({transform:s+" "+e+" "+i})}}},{key:"moveOf",value:function(t,e,i,n){var o=t,s=e;if(i){var r=this.rotation*Math.PI/180;o=Math.cos(r)*e+Math.cos(r+Math.PI/2)*t,s=Math.sin(r)*e+Math.sin(r+Math.PI/2)*t}this.moveTo(this.x+o,this.y+s,!1,n)}},{key:"moveTo",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Quad.easeOut,s=1*t,r=1*e;return i&&(s+=1*this.x,r+=1*this.y),this._tween_position&&this._tween_position.pause(),this._tween_position=TweenLite.to(this,n,{x:s,y:r,ease:o}),this}},{key:"scaleTo",value:function(t){return this._scale.x=t,this._scale.y=t,this._scale.z=t,this}},{key:"rotateOf",value:function(t,e,i){return this.rotateTo(t+this.rotation,e,i)}},{key:"rotateTo",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Quad.easeOut,n=t%360;n%=360;var o;return this.rotationForceDirection>0?(o=n-this.rotation%360,this.rotation%=360,o<0&&(n+=360)):this.rotationForceDirection<0?(o=n-this.rotation%360,this.rotation%=360,o>0&&(n-=360)):this.shortRotation&&(o=n-this.rotation,o<-180?this.rotation=this.rotation%360-360:o>180&&(this.rotation=this.rotation%360+360)),this._tween_rotation&&this._tween_rotation.pause(),this._tween_rotation=TweenLite.to(this,e,{rotation:n,ease:i}),this}},{key:"setStage",value:function(t){this.root=t,this._children.every(function(e){e.setStage(t)})}},{key:"setPivot",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(t*=1,e*=1,i*=1,n){var o=t-this._pivotMove.x,s=e-this._pivotMove.y;i-this._pivotMove.z;this.moveTo(o,s,!0)}return this._pivotMove={x:t,y:e,z:i},this.askRefresh(),this}},{key:"x",get:function(){return this._position.x},set:function(t){this._position.x=t,this.askRefresh()}},{key:"y",get:function(){return this._position.y},set:function(t){this._position.y=t,this.askRefresh()}},{key:"rotation",get:function(){return this._rotation.z},set:function(t){this._rotation.z=t,this.askRefresh()}},{key:"scaleX",get:function(){return this._scale.x},set:function(t){this._scale.x=t,this.askRefresh()}},{key:"scaleY",get:function(){return this._scale.y},set:function(t){this._scale.y=t,this.askRefresh()}}]),t}();
//# sourceMappingURL=all.js.map
