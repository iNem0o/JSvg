{"version":3,"sources":["Svg/JNode.js","Svg/JSVG.js","Svg/JSprite.js"],"names":["JNode","nodeName","$node","$","document","createElementNS","position","x","y","attr","k","v","JSVG","svg","$svg","root","JSprite","setStage","append","need_refresh","setFramerate","setTickrate","event","params","trigger","event_name","listener","on","fps","self","clearInterval","tick_interval","interval_ms","lastTick","performance","now","tick","time_ratio","setInterval","onEnterFrame","refresh","window","requestAnimationFrame","fps_interval","l","h","child","addChild","JKeyboard","left","right","up","down","esc","enter","space","keys","e","which","preventDefault","stopPropagation","JRect","w","width","height","$node_origin","nowrap","wrap","parent","addClass","find","children","_position","z","_rotation","_pivotMove","_scale","shortRotation","rotationForceDirection","_tween_rotation","needRefresh","clone","push","addGraphic","graphic","askRefresh","applyTransform","every","round2","num","Math","round","scale_transform","rotate_transform","translate_transform","directional","vitesse","dx","dy","arad","rotation","PI","cos","sin","moveTo","relative","ratio","angle","ease","rotateTo","Quad","easeOut","next_rotation","distance","pause","TweenLite","to","stage","compensation","dz","scale"],"mappings":"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","file":"all.js","sourcesContent":["class JNode {\n    constructor(nodeName) {\n        this.$node = $(document.createElementNS('http://www.w3.org/2000/svg', nodeName));\n        this.position = function (x, y) {\n            this.$node\n                .attr({\n                    x: x,\n                    y: y\n                });\n            return this;\n        };\n    }\n    attr(k, v) {\n        this.$node.attr(k, v);\n        return this;\n    }\n}\n","class JSVG {\n    constructor(svg) {\n        if (!svg) {\n            this.$svg = new JNode(\"svg\").$node;\n            this.root = new JSprite(new JNode(\"g\").attr(\"root\", 1));\n            this.root.setStage(this);\n            this.$svg.append(this.root.$node);\n        } else {\n            this.$svg = svg;\n            //TODO : apprentissage /  découverte\n        }\n\n        this.need_refresh = false;\n\n        this.setFramerate();\n        this.setTickrate(100);\n    }\n\n    trigger(event, params) {\n        this.root.$node.trigger(event, params);\n    };\n\n    on(event_name, listener) {\n        this.root.$node.on(event_name, listener);\n    };\n\n    setTickrate(fps) {\n        var self=this;\n        clearInterval(this.tick_interval);\n        var interval_ms = 1000 / fps;\n        var lastTick = performance.now(),\n            tick = function () {\n                var tick = performance.now();\n                var params = [{\n                    time_ratio: (tick - lastTick) / interval_ms\n                }];\n                self.trigger(\"tick\", params);\n                lastTick = tick;\n            };\n        this.tick_interval = setInterval(tick, interval_ms);\n        return this;\n    };\n\n    setFramerate(fps) {\n        this.fps = fps || \"max\";\n        var self = this;\n        var onEnterFrame = function () {\n            //this.dispatchEvent(new Event(\"EnterFrame\",this));\n            if (self.need_refresh) {\n                self.root.refresh();\n                self.need_refresh = false;\n            }\n            if (self.fps == \"max\" && window.requestAnimationFrame) window.requestAnimationFrame(onEnterFrame);\n        };\n\n        clearInterval(this.fps_interval);\n        if (this.fps == \"max\" && window.requestAnimationFrame) window.requestAnimationFrame(onEnterFrame);\n        else {\n            this.fps_interval = setInterval(onEnterFrame, 1000 / this.fps);\n        }  // 50 fps\n        return this;\n\n    };\n\n    askRefresh() {\n        this.need_refresh = true;\n    };\n\n    getRoot() {\n        return this.$svg;\n    };\n\n    setViewBox(x, y, l, h) {\n        this.$svg.attr(\"viewBox\", x + \" \" + y + \" \" + l + \" \" + h);\n        return this;\n    };\n\n    addChild(child) {\n        this.root.addChild(child);\n        return this;\n    };\n}\n\n\nclass JKeyboard {\n    constructor() {\n        this.left = 37;\n        this.right = 39;\n        this.up = 38;\n        this.down = 40;\n        this.esc = 27;\n        this.enter = 13;\n        this.space = 32;\n        this.keys = [];\n\n        var self = this;\n        $(document).on(\"keydown\", function (e) {\n            self.keys[e.which] = true;\n            if (e.which != 116) {\n                e.preventDefault();\n                e.stopPropagation();\n            }\n\n        }).on(\"keyup\", function (e) {\n            self.keys[e.which] = false;\n        });\n    }\n\n    isDown(which) {\n        return this.keys[which] ? true : false;\n    }\n\n}\n\nclass JRect extends JNode{\n    constructor(x, y, w, h) {\n        super(\"rect\");\n        this.position(x, y)\n            .attr({\n                width: w,\n                height: h\n            });\n    };\n}\n\n","class JSprite {\n    constructor($node_origin, nowrap) {\n        if ($node_origin instanceof JNode) $node_origin = $node_origin.$node;\n        // wrap le noeud\n\n        if (!nowrap) {\n            $node_origin.wrap(document.createElementNS('http://www.w3.org/2000/svg', 'g'));\n            this.$node = $node_origin.parent();\n            this.$node_origin = $node_origin;\n            this.$node_origin.addClass(\"child-node\");\n        } else {\n            this.$node = $node_origin;\n            this.$node_origin = $node_origin.find(\">.child-node\");\n\n        }\n\n        this.root = null;\n\n        this.children = [];\n        this._position = {x: 0, y: 0, z: 0};\n        this._rotation = {x: 0, y: 0, z: 0};\n        this._pivotMove = {x: 0, y: 0, z: 0};\n        this._scale = {x: 1, y: 1, z: 1};\n\n        this.shortRotation = true;\n        this.rotationForceDirection = 0;\n        this._tween_rotation = false;\n\n        this.needRefresh = false;\n    }\n\n    clone() {\n        return new JSprite(this.$node.clone(), true);\n    };\n\n\n    addChild(child) {\n        this.children.push(child);\n        child.setStage(this.root);\n        this.addGraphic(child);\n        return this;\n    }\n\n    addGraphic(graphic) {\n        this.$node.append(graphic.$node)\n    }\n\n    /*\n     gestion de l'affichage\n     */\n    askRefresh() {\n        this.needRefresh = true;\n        if (this.root) {\n            this.root.askRefresh();\n        } else {\n            this.applyTransform();\n        }\n    };\n\n    refresh() {\n        //console.log(\"refresh\",this.children.length);\n        this.applyTransform();\n        this.children.every(function (child) {\n            child.refresh();\n        });\n    };\n\n\n    applyTransform() {\n        if (this.needRefresh) {\n            var round2 = function (num) {\n                return Math.round(num * 100) / 100;\n            };\n            this.needRefresh = false;\n            var scale_transform = \"scale(\" + round2(this._scale.x) + \")\";\n\n            var rotate_transform = \"rotate(\" + round2(this._rotation.z) + \" \" + round2(this._pivotMove.x) + \",\" + round2(this._pivotMove.y) + \")\";\n            //this.$node.attr(\"transform\", rotate_transform);\n\n\n            var x =round2(this._position.x - (this._pivotMove.x * this._scale.x)),\n                y=round2(this._position.y - (this._pivotMove.y * this._scale.y)),\n                translate_transform=\"translate(\"+x+\" \"+y+\")\";\n            //console.log(this.$node,translate_transform + \" \" + scale_transform + \" \" + rotate_transform);\n            this.$node.attr({\n                \"transform\":translate_transform + \" \" + scale_transform + \" \" + rotate_transform\n                //\"x\":x,\n                //\"y\":y\n            });\n        }\n    };\n\n    get x() {\n        return this._position.x;\n    }\n\n    set x(x) {\n        this._position.x = x;\n        this.askRefresh();\n    }\n\n\n    get y() {\n        return this._position.y;\n    }\n\n    set y(y) {\n        this._position.y = y;\n        this.askRefresh();\n    }\n\n    get rotation() {\n        return this._rotation.z;\n    }\n\n    set rotation(angle) {\n        this._rotation.z = angle;\n        this.askRefresh();\n    }\n\n    get scaleX() {\n        return this._scale.x;\n    }\n\n    set scaleX(scale) {\n        this._scale.x = scale;\n        this.askRefresh();\n    }\n\n    get scaleY() {\n        return this._scale.y;\n    }\n\n    set scaleY(scale) {\n        this._scale.y = scale;\n        this.askRefresh();\n    }\n\n    /*\n     public methods pour manipulation\n     */\n    moveOf(x, y, directional, vitesse) {\n        var dx = x, dy = y;\n        if (directional) {\n            var arad = this.rotation * Math.PI / 180;\n            dx = Math.cos(arad) * y + Math.cos(arad + Math.PI / 2) * x;\n            dy = Math.sin(arad) * y + Math.sin(arad + Math.PI / 2) * x;\n            //console.log(\"x,y\",dx,dy);\n        }\n        this.moveTo(this.x + dx, this.y + dy,false,vitesse);\n    };\n\n    moveTo(x, y, relative=false, vitesse=0) {\n\n        if (relative) {\n            this.x += x;\n            this.y += y;\n        } else {\n            this.x = x;\n            this.y = y;\n        }\n        return this;\n    };\n\n    scaleTo(ratio) {\n        this._scale.x = ratio;\n        this._scale.y = ratio;\n        this._scale.z = ratio;\n        return this;\n    };\n\n    rotateOf(angle, vitesse, ease) {\n        return this.rotateTo(angle + this.rotation, vitesse, ease)\n    };\n\n    rotateTo(angle, vitesse, ease) {\n        vitesse = vitesse || 0;\n        ease = ease || Quad.easeOut;\n\n        var next_rotation = angle;\n\n        next_rotation %= 360;\n\n        // shortRotation : évite de tourner à l'envers au tour complet ;)\n        var distance;\n        if (this.rotationForceDirection > 0) {\n            distance = next_rotation - (this.rotation % 360);\n            // ex : 80 -> 70 => diff = -10 => -280 -> 70\n            this.rotation %= 360;\n            if (distance < 0) {\n                next_rotation += 360;\n            }\n        } else if (this.rotationForceDirection < 0) {\n            distance = next_rotation - (this.rotation % 360);\n            // ex : 80 -> 70 => diff = -10 => -280 -> 70\n            this.rotation %= 360;\n            if (distance > 0) {\n                next_rotation -= 360;\n            }\n        } else if (this.shortRotation) {\n            distance = next_rotation - this.rotation;\n            if (distance < -180) {\n                // (on revient en arrière)\n                this.rotation = this.rotation % 360 - 360;\n            } else if (distance > 180) {\n                // ex : 0 -> 270 => diff = 270 => 360 -> 270\n                this.rotation = this.rotation % 360 + 360;\n                // (on retourne)\n            }\n        }\n        if (this._tween_rotation) this._tween_rotation.pause();\n        this._tween_rotation = TweenLite.to(this, vitesse, {rotation: next_rotation, ease: ease});\n        return this;\n//\n    };\n\n    setStage(stage) {\n        this.root = stage;\n        this.children.every(function (child) {\n            child.setStage(stage);\n        })\n    };\n\n    setPivot(x, y, z, compensation) {\n        compensation = (typeof compensation === \"undefined\" ? true : compensation);\n        x = x || 0;\n        y = y || 0;\n        z = z || 0;\n\n        if (compensation) {\n            var dx = x - this._pivotMove.x,\n                dy = y - this._pivotMove.y,\n                dz = z - this._pivotMove.z;\n            this.moveTo(dx, dy, true);\n        }\n\n        this._pivotMove = {x: x, y: y, z: z};\n\n        this.askRefresh();                                          // refresh du pivot\n        return this;\n    };\n}\n"]}