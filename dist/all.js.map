{"version":3,"sources":["Svg/JNode.js","Svg/JSVG.js","Svg/JSprite.js"],"names":["JNode","nodeName","$node","$","document","createElementNS","position","x","y","attr","k","v","JSVG","svg","$svg","root","JSprite","setStage","need_refresh","setFramerate","setTickrate","event","params","trigger","event_name","listener","on","fps","self","clearInterval","tick_interval","interval_ms","lastTick","performance","now","tick","time_ratio","setInterval","onEnterFrame","refresh","window","requestAnimationFrame","fps_interval","l","h","child","addChild","JKeyboard","left","right","up","down","esc","enter","space","keys","e","which","preventDefault","stopPropagation","JRect","w","width","height","$node_origin","nowrap","wrap","parent","addClass","find","_children","_position","z","_rotation","_pivotMove","_scale","shortRotation","rotationForceDirection","_tween_rotation","_tween_position","needRefresh","clone","push","addGraphic","graphic","append","askRefresh","applyTransform","every","round2","num","Math","round","scale_transform","rotate_transform","translate_transform","directional","vitesse","dx","dy","arad","rotation","PI","cos","sin","moveTo","relative","ease","Quad","easeOut","next_x","next_y","pause","TweenLite","to","ratio","angle","rotateTo","next_rotation","distance","stage","compensation","dz","scale"],"mappings":"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","file":"all.js","sourcesContent":["class JNode {\n    constructor(nodeName) {\n        this.$node = $(document.createElementNS('http://www.w3.org/2000/svg', nodeName));\n        this.position = function (x, y) {\n            this.$node\n                .attr({\n                    x: x,\n                    y: y\n                });\n            return this;\n        };\n    }\n    attr(k, v) {\n        this.$node.attr(k, v);\n        return this;\n    }\n}\n","class JSVG {\n    constructor(svg) {\n        if (!svg) {\n            this.$svg = new JNode(\"svg\").$node;\n        } else {\n            this.$svg = svg;\n            //TODO : apprentissage /  découverte\n        }\n        this.root = new JSprite(this.$svg,true);\n        this.root.setStage(this);\n\n        this.need_refresh = false;\n\n        // full speed par défaut\n        this.setFramerate();\n\n        // 100 ticks par seconde par défaut\n        this.setTickrate(100);\n    }\n\n    trigger(event, params) {\n        this.root.$node.trigger(event, params);\n    };\n\n    on(event_name, listener) {\n        this.root.$node.on(event_name, listener);\n    };\n\n    setTickrate(fps) {\n        var self=this;\n        clearInterval(this.tick_interval);\n        var interval_ms = 1000 / fps;\n        var lastTick = performance.now(),\n            tick = function () {\n                var tick = performance.now();\n                var params = [{\n                    time_ratio: (tick - lastTick) / interval_ms\n                }];\n                self.trigger(\"tick\", params);\n                lastTick = tick;\n            };\n        this.tick_interval = setInterval(tick, interval_ms);\n        return this;\n    };\n\n    setFramerate(fps) {\n        this.fps = fps || \"max\";\n        var self = this;\n        var onEnterFrame = function () {\n            //this.dispatchEvent(new Event(\"EnterFrame\",this));\n            if (self.need_refresh) {\n                self.root.refresh();\n                self.need_refresh = false;\n            }\n            if (self.fps == \"max\" && window.requestAnimationFrame) window.requestAnimationFrame(onEnterFrame);\n        };\n\n        clearInterval(this.fps_interval);\n        if (this.fps == \"max\" && window.requestAnimationFrame) window.requestAnimationFrame(onEnterFrame);\n        else {\n            this.fps_interval = setInterval(onEnterFrame, 1000 / this.fps);\n        }  // 50 fps\n        return this;\n\n    };\n\n    askRefresh() {\n        this.need_refresh = true;\n    };\n\n    getRoot() {\n        return this.$svg;\n    };\n\n    setViewBox(x, y, l, h) {\n        this.$svg.attr(\"viewBox\", x + \" \" + y + \" \" + l + \" \" + h);\n        return this;\n    };\n\n    addChild(child) {\n        this.root.addChild(child);\n        return this;\n    };\n}\n\n\nclass JKeyboard {\n    constructor() {\n        this.left = 37;\n        this.right = 39;\n        this.up = 38;\n        this.down = 40;\n        this.esc = 27;\n        this.enter = 13;\n        this.space = 32;\n        this.keys = [];\n\n        var self = this;\n        $(document).on(\"keydown\", function (e) {\n            self.keys[e.which] = true;\n            if (e.which != 116) {\n                e.preventDefault();\n                e.stopPropagation();\n            }\n\n        }).on(\"keyup\", function (e) {\n            self.keys[e.which] = false;\n        });\n    }\n\n    isDown(which) {\n        return this.keys[which] ? true : false;\n    }\n\n}\n\nclass JRect extends JNode{\n    constructor(x, y, w, h) {\n        super(\"rect\");\n        this.position(x, y)\n            .attr({\n                width: w,\n                height: h\n            });\n    };\n}\n\n","class JSprite {\n    constructor($node_origin, nowrap) {\n        if ($node_origin instanceof JNode) $node_origin = $node_origin.$node;\n        // wrap le noeud\n\n        if (!nowrap) {\n            $node_origin.wrap(document.createElementNS('http://www.w3.org/2000/svg', 'g'));\n            this.$node = $node_origin.parent();\n            this.$node_origin = $node_origin;\n            this.$node_origin.addClass(\"child-node\");\n        } else {\n            this.$node = $node_origin;\n            this.$node_origin = $node_origin.find(\">.child-node\");\n\n        }\n\n        this.root = null;\n\n        this._children = [];\n        this._position = {x: 0, y: 0, z: 0};\n        this._rotation = {x: 0, y: 0, z: 0};\n        this._pivotMove = {x: 0, y: 0, z: 0};\n        this._scale = {x: 1, y: 1, z: 1};\n\n        this.shortRotation = true;\n        this.rotationForceDirection = 0;\n        this._tween_rotation = false;\n        this._tween_position = false;\n\n        this.needRefresh = false;\n    }\n\n    clone() {\n        return new JSprite(this.$node.clone(), true);\n    };\n\n\n    addChild(child) {\n        this._children.push(child);\n        child.setStage(this.root);\n        this.addGraphic(child);\n        return this;\n    }\n\n    addGraphic(graphic) {\n        this.$node.append(graphic.$node)\n    }\n\n    /*\n     gestion de l'affichage\n     */\n    askRefresh() {\n        this.needRefresh = true;\n        if (this.root) {\n            this.root.askRefresh();\n        } else {\n            this.applyTransform();\n        }\n    };\n\n    refresh() {\n        //console.log(\"refresh\",this._children.length);\n        this.applyTransform();\n        this._children.every(function (child) {\n            child.refresh();\n        });\n    };\n\n\n    applyTransform() {\n        if (this.needRefresh) {\n            var round2 = function (num) {\n                return Math.round(num * 100) / 100;\n            };\n            this.needRefresh = false;\n            var scale_transform = \"scale(\" + round2(this._scale.x) + \")\";\n\n            var rotate_transform = \"rotate(\" + round2(this._rotation.z) + \" \" + round2(this._pivotMove.x) + \",\" + round2(this._pivotMove.y) + \")\";\n            //this.$node.attr(\"transform\", rotate_transform);\n\n\n            var x =round2(this._position.x - (this._pivotMove.x * this._scale.x)),\n                y=round2(this._position.y - (this._pivotMove.y * this._scale.y)),\n                translate_transform=\"translate(\"+x+\" \"+y+\")\";\n            //console.log(this.$node,translate_transform + \" \" + scale_transform + \" \" + rotate_transform);\n            this.$node.attr({\n                \"transform\":translate_transform + \" \" + scale_transform + \" \" + rotate_transform\n                //\"x\":x,\n                //\"y\":y\n            });\n        }\n    };\n\n    get x() {\n        return this._position.x;\n    }\n\n    set x(x) {\n        this._position.x = x;\n        this.askRefresh();\n    }\n\n\n    get y() {\n        return this._position.y;\n    }\n\n    set y(y) {\n        this._position.y = y;\n        this.askRefresh();\n    }\n\n    get rotation() {\n        return this._rotation.z;\n    }\n\n    set rotation(angle) {\n        this._rotation.z = angle;\n        this.askRefresh();\n    }\n\n    get scaleX() {\n        return this._scale.x;\n    }\n\n    set scaleX(scale) {\n        this._scale.x = scale;\n        this.askRefresh();\n    }\n\n    get scaleY() {\n        return this._scale.y;\n    }\n\n    set scaleY(scale) {\n        this._scale.y = scale;\n        this.askRefresh();\n    }\n\n    /*\n     public methods pour manipulation\n     */\n    moveOf(x, y, directional, vitesse) {\n        var dx = x, dy = y;\n        if (directional) {\n            var arad = this.rotation * Math.PI / 180;\n            dx = Math.cos(arad) * y + Math.cos(arad + Math.PI / 2) * x;\n            dy = Math.sin(arad) * y + Math.sin(arad + Math.PI / 2) * x;\n            //console.log(\"x,y\",dx,dy);\n        }\n        this.moveTo(this.x + dx, this.y + dy,false,vitesse);\n    };\n\n    moveTo(x, y, relative=false, vitesse=0,ease=Quad.easeOut) {\n        var next_x = x,\n            next_y = y\n            ;\n\n        if (relative) {\n            next_x += this.x;\n            next_y += this.y;\n        }\n\n        if (this._tween_position) this._tween_position.pause();\n        this._tween_position = TweenLite.to(this, vitesse, {x: next_x,y:next_y, ease: ease});\n        return this;\n\n    };\n\n    scaleTo(ratio) {\n        this._scale.x = ratio;\n        this._scale.y = ratio;\n        this._scale.z = ratio;\n        return this;\n    };\n\n    rotateOf(angle, vitesse, ease) {\n        return this.rotateTo(angle + this.rotation, vitesse, ease)\n    };\n\n    rotateTo(angle, vitesse=0, ease=Quad.easeOut) {\n\n        var next_rotation = angle%360;\n\n        next_rotation %= 360;\n\n        // shortRotation : évite de tourner à l'envers au tour complet ;)\n        var distance;\n        if (this.rotationForceDirection > 0) {\n            distance = next_rotation - (this.rotation % 360);\n            // ex : 80 -> 70 => diff = -10 => -280 -> 70\n            this.rotation %= 360;\n            if (distance < 0) {\n                next_rotation += 360;\n            }\n        } else if (this.rotationForceDirection < 0) {\n            distance = next_rotation - (this.rotation % 360);\n            // ex : 80 -> 70 => diff = -10 => -280 -> 70\n            this.rotation %= 360;\n            if (distance > 0) {\n                next_rotation -= 360;\n            }\n        } else if (this.shortRotation) {\n            distance = next_rotation - this.rotation;\n            if (distance < -180) {\n                // (on revient en arrière)\n                this.rotation = this.rotation % 360 - 360;\n            } else if (distance > 180) {\n                // ex : 0 -> 270 => diff = 270 => 360 -> 270\n                this.rotation = this.rotation % 360 + 360;\n                // (on retourne)\n            }\n        }\n        if (this._tween_rotation) this._tween_rotation.pause();\n        this._tween_rotation = TweenLite.to(this, vitesse, {rotation: next_rotation, ease: ease});\n        return this;\n//\n    };\n\n    setStage(stage) {\n        this.root = stage;\n        this._children.every(function (child) {\n            child.setStage(stage);\n        })\n    };\n\n    setPivot(x, y, z, compensation) {\n        compensation = (typeof compensation === \"undefined\" ? true : compensation);\n        x = x || 0;\n        y = y || 0;\n        z = z || 0;\n\n        if (compensation) {\n            var dx = x - this._pivotMove.x,\n                dy = y - this._pivotMove.y,\n                dz = z - this._pivotMove.z;\n            this.moveTo(dx, dy, true);\n        }\n\n        this._pivotMove = {x: x, y: y, z: z};\n\n        this.askRefresh();                                          // refresh du pivot\n        return this;\n    };\n}\n"]}